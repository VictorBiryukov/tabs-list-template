fragment CustomerAttributes on _E_Customer {
  id
  __typename
	data {
    name
    address
  }
}

mutation addCustomerInfo($customerInput: _CreateCustomerInput!) {
  packet {
    updateOrCreateCustomer(input: $customerInput) {
      returning {
        ...CustomerAttributes
      }
    }
  }
}

query getCustomerInfo($cond: String!) {
  searchCustomer(cond: $cond){
    elems {
      ...CustomerAttributes
    }
  }
}

fragment GoodTypeAttributes on _E_GoodType {
  id
  __typename
  name
  descr
  price
  vendor {
    entity{
      id
      __typename
      name
    }
  }
}

query searchGoodType {
  searchGoodType {
    elems {
      ...GoodTypeAttributes
    }
  }
}

fragment DetailAttributes on _E_Detail {
      id
      __typename
      goodType {
        entity {
          ...GoodTypeAttributes
        }
      }  
}

fragment OrderAttributes on _E_Order {
  id
  __typename
  openOrderFlag
  orderDate
  comment
  statusForCUSTOMER{
    code
  }
  details {
    elems {
			...DetailAttributes
    }
  }
}

query searchOrder($cond: String) {
  searchOrder(cond: $cond, sort:{crit:"it.orderDate", order:DESC} ) {
    elems {
      ...OrderAttributes
    }
  }
}

query searchAllOrder{
  searchOrder(sort:{crit:"it.customer.entityId", order:DESC} ) {
    elems {
      customer{
        entityId
      }
      ...OrderAttributes
    }
  }
}

mutation addOrderDetail($customerId: String!, $goodTypeId: String!) {
  packet {
    updateOrCreateOrder(input: {openOrderFlag: $customerId, customer:{entityId: $customerId}}, exist: {byKey: openOrderFlag}) {
      returning {
        ...OrderAttributes
      }
    }
    createDetail(input: {order: "ref:updateOrCreateOrder", goodType: {entityId: $goodTypeId}}) {
      ...DetailAttributes
    }
  }
}

mutation deleteDetail($detailId:ID!){
  packet{
    deleteDetail(id: $detailId )
  }
}

mutation fixOrder($orderId: ID!){
  packet{
    updateOrder(input:{
      id:$orderId
      openOrderFlag:null
      statusForCUSTOMER:{
        code:"FIXED"
      }
    }){
      ...OrderAttributes
    }
  }
}
